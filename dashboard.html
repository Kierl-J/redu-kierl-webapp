<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
</head>
<body>
    <h1>Welcome to Your Dashboard</h1>
    <p>Coins: <span id="coinCount">0</span></p>

    <button onclick="visitFacebook()">Visit Facebook and Earn Coins</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

        const firebaseConfig = { /* Your Firebase Config Here */ };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const userId = "user123"; // Example user ID; replace with dynamic data as needed
        const coinDisplay = document.getElementById('coinCount');

        async function loadCoins() {
            const docRef = doc(db, "users", userId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                coinDisplay.textContent = data.coins || 0;
            } else {
                await setDoc(docRef, { coins: 0, lastVisit: null });
            }
        }

        async function visitFacebook() {
            const docRef = doc(db, "users", userId);
            const docSnap = await getDoc(docRef);
            const data = docSnap.data();

            const now = new Date();
            const lastVisit = data.lastVisit ? new Date(data.lastVisit) : null;

            // Cooldown logic: Check if last visit was within 24 hours
            if (lastVisit && now - lastVisit < 24 * 60 * 60 * 1000) {
                alert("You've already earned a coin today. Try again tomorrow!");
                return;
            }

            // Reward user with a coin
            const visited = confirm("Click OK to visit Facebook. You will earn a coin!");
            if (visited) {
                window.open('https://facebook.com', '_blank');

                await updateDoc(docRef, {
                    coins: (data.coins || 0) + 1,
                    lastVisit: now.toISOString() // Save timestamp for cooldown tracking
                });

                loadCoins(); // Refresh the coin count
            }
        }

        loadCoins(); // Load coins on page load
    </script>
</body>
</html>
